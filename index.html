<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8-Ball Pool</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 10px;
            background: #1a4d3a;
            color: white;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: auto;
        }
        
        h1 {
            margin: 0 0 15px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            text-align: center;
        }
        
        #gameContainer {
            position: relative;
            border: clamp(3px, 1vw, 10px) solid #8B4513;
            border-radius: 10px;
            background: #228B22;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            max-width: 100%;
            max-height: 70vh;
        }
        
        canvas {
            display: block;
            background: linear-gradient(45deg, #228B22 25%, transparent 25%), 
                        linear-gradient(-45deg, #228B22 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #228B22 75%), 
                        linear-gradient(-45deg, transparent 75%, #228B22 75%);
            background-size: 30px 30px;
            background-position: 0 0, 0 15px, 15px -15px, -15px 0px;
            max-width: 100%;
            height: auto;
        }
        
        #controls {
            margin-top: 15px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
            max-width: 800px;
            padding: 0 10px;
        }
        
        #powerContainer {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 200px;
            flex: 1;
            max-width: 300px;
        }
        
        #power {
            flex: 1;
            height: 12px;
            background: #333;
            border-radius: 6px;
            overflow: hidden;
            min-width: 150px;
        }
        
        #powerBar {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #ffff00, #ff0000);
            width: 0%;
            transition: width 0.1s;
        }
        
        button {
            padding: clamp(8px, 2vw, 12px) clamp(15px, 3vw, 20px);
            background: #8B4513;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: clamp(14px, 2.5vw, 16px);
            transition: background 0.3s;
            white-space: nowrap;
        }
        
        button:hover {
            background: #A0522D;
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        #info {
            display: flex;
            gap: clamp(10px, 3vw, 30px);
            margin-top: 15px;
            font-size: clamp(14px, 2.5vw, 18px);
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
            max-width: 800px;
            padding: 0 10px;
        }
        
        .player {
            padding: clamp(8px, 2vw, 12px);
            border-radius: 5px;
            background: rgba(0,0,0,0.3);
            text-align: center;
            min-width: 140px;
            flex: 1;
            max-width: 200px;
        }
        
        .player.active {
            background: rgba(255,255,0,0.3);
        }
        
        #gameStatus {
            text-align: center;
            min-width: 120px;
            flex: 1;
            max-width: 150px;
        }
        
        #instructions {
            max-width: 95%;
            margin-top: 15px;
            text-align: center;
            font-size: clamp(12px, 2vw, 14px);
            opacity: 0.8;
            padding: 0 10px;
            line-height: 1.4;
        }
        
        /* Mobile specific styles */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            h1 {
                margin-bottom: 10px;
            }
            
            #gameContainer {
                max-height: 50vh;
            }
            
            #controls {
                margin-top: 10px;
                gap: 10px;
            }
            
            #info {
                flex-direction: column;
                gap: 10px;
                align-items: center;
            }
            
            .player {
                width: 100%;
                max-width: 300px;
            }
            
            #gameStatus {
                width: 100%;
                max-width: 300px;
                padding: 10px;
                background: rgba(0,0,0,0.3);
                border-radius: 5px;
            }
            
            #powerContainer {
                width: 100%;
                justify-content: center;
            }
            
            button {
                min-width: 120px;
            }
        }
        
        @media (max-width: 480px) {
            #gameContainer {
                max-height: 45vh;
            }
            
            #instructions {
                font-size: 11px;
                margin-top: 10px;
            }
        }
        
        /* Landscape mobile */
        @media (max-height: 500px) and (orientation: landscape) {
            #gameContainer {
                max-height: 60vh;
            }
            
            #info {
                flex-direction: row;
                gap: 15px;
                font-size: 14px;
            }
            
            .player, #gameStatus {
                min-width: auto;
                padding: 5px 8px;
            }
        }
    </style>
</head>
<body>
    <h1>üé± ZUGE BOLLAS</h1>
    
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="400"></canvas>
    </div>
    
    <div id="controls">
        <div id="powerContainer">
            <label>For√ßa: </label>
            <div id="power">
                <div id="powerBar"></div>
            </div>
        </div>
        <button onclick="resetGame()">Novo Jogo</button>
    </div>
    
    <div id="info">
        <div id="player1" class="player active">
            <strong>Jogador 1</strong><br>
            Bolas: <span id="p1Balls">Lisas (1-7)</span>
        </div>
        <div id="player2" class="player">
            <strong>Jogador 2</strong><br>
            Bolas: <span id="p2Balls">Listradas (9-15)</span>
        </div>
        <div id="gameStatus">
            <strong>Status:</strong><br>
            <span id="status">Vez do Jogador 1</span>
        </div>
    </div>
    
    <div id="instructions">
        <p><strong>Como jogar:</strong> Clique e arraste para mirar. Solte para atirar. Use a barra de for√ßa para controlar a pot√™ncia.</p>
        <p>Objetivo: Encape todas as suas bolas (lisas ou listradas) e depois a bola 8 preta.</p>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const powerBar = document.getElementById('powerBar');
        
        let balls = [];
        let cueBall = null;
        let aimLine = null;
        let isDragging = false;
        let currentPlayer = 1;
        let gameEnded = false;
        let power = 0;
        let powerDirection = 1;
        let powerInterval = null;
        
        // Configura√ß√µes do jogo
        let BALL_RADIUS = 12;
        const FRICTION = 0.98;
        const MIN_SPEED = 0.1;
        const MAX_POWER = 15;
        
        class Ball {
            constructor(x, y, number, color) {
                this.x = x;
                this.y = y;
                this.vx = 0;
                this.vy = 0;
                this.radius = BALL_RADIUS;
                this.number = number;
                this.color = color;
                this.pocketed = false;
                this.isCue = number === 0;
                this.isEightBall = number === 8;
                this.isSolid = number >= 1 && number <= 7;
                this.isStripe = number >= 9 && number <= 15;
            }
            
            update() {
                if (this.pocketed) return;
                
                this.x += this.vx;
                this.y += this.vy;
                
                // Aplicar atrito
                this.vx *= FRICTION;
                this.vy *= FRICTION;
                
                // Parar se muito devagar
                if (Math.abs(this.vx) < MIN_SPEED && Math.abs(this.vy) < MIN_SPEED) {
                    this.vx = 0;
                    this.vy = 0;
                }
                
                // Colis√£o com bordas
                if (this.x - this.radius <= 0 || this.x + this.radius >= canvas.width) {
                    this.vx = -this.vx;
                    this.x = Math.max(this.radius, Math.min(canvas.width - this.radius, this.x));
                }
                if (this.y - this.radius <= 0 || this.y + this.radius >= canvas.height) {
                    this.vy = -this.vy;
                    this.y = Math.max(this.radius, Math.min(canvas.height - this.radius, this.y));
                }
                
                // Verificar ca√ßapas (cantos e meio das laterais)
                this.checkPockets();
            }
            
            checkPockets() {
                const pocketSize = Math.max(12, canvas.width * 0.025);
                const borderOffset = Math.max(15, canvas.width * 0.03);
                
                const pockets = [
                    {x: borderOffset, y: borderOffset}, 
                    {x: canvas.width/2, y: borderOffset * 0.8}, 
                    {x: canvas.width - borderOffset, y: borderOffset},
                    {x: borderOffset, y: canvas.height - borderOffset}, 
                    {x: canvas.width/2, y: canvas.height - borderOffset * 0.8}, 
                    {x: canvas.width - borderOffset, y: canvas.height - borderOffset}
                ];
                
                for (let pocket of pockets) {
                    const dist = Math.sqrt((this.x - pocket.x)**2 + (this.y - pocket.y)**2);
                    if (dist < pocketSize + 5) {
                        this.pocket();
                        break;
                    }
                }
            }
            
            pocket() {
                this.pocketed = true;
                this.vx = 0;
                this.vy = 0;
                
                if (this.isCue) {
                    // Reposicionar bola branca
                    this.x = canvas.width * 0.25;
                    this.y = canvas.height / 2;
                    this.pocketed = false;
                    switchPlayer();
                } else if (this.isEightBall) {
                    endGame();
                } else {
                    checkPlayerBalls();
                }
            }
            
            draw() {
                if (this.pocketed) return;
                
                ctx.save();
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                
                if (this.isCue) {
                    ctx.fillStyle = 'white';
                    ctx.fill();
                    ctx.strokeStyle = '#ddd';
                } else {
                    ctx.fillStyle = this.color;
                    ctx.fill();
                    
                    // N√∫mero na bola
                    if (this.isStripe) {
                        // Faixa branca para bolas listradas
                        ctx.fillStyle = 'white';
                        ctx.fillRect(this.x - this.radius + 3, this.y - 3, this.radius * 2 - 6, 6);
                    }
                    
                    ctx.fillStyle = this.isStripe || this.isEightBall ? 'white' : 'black';
                    ctx.font = '10px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(this.number.toString(), this.x, this.y + 3);
                    
                    ctx.strokeStyle = '#333';
                }
                
                ctx.lineWidth = 1;
                ctx.stroke();
                ctx.restore();
            }
        }
        
        function initGame() {
            balls = [];
            gameEnded = false;
            currentPlayer = 1;
            updateUI();
            
            // Ajustar tamanho do canvas baseado na tela
            adjustCanvasSize();
            
            // Bola branca
            cueBall = new Ball(canvas.width * 0.25, canvas.height / 2, 0, 'white');
            balls.push(cueBall);
            
            // Cores das bolas
            const colors = ['white', '#FFD700', '#0000FF', '#FF0000', '#800080', '#FF8C00', '#008000', '#8B0000', '#000000', '#FFD700', '#0000FF', '#FF0000', '#800080', '#FF8C00', '#008000', '#8B0000'];
            
            // Tri√¢ngulo de bolas
            const startX = canvas.width * 0.75;
            const startY = canvas.height / 2;
            let ballIndex = 1;
            
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col <= row; col++) {
                    if (ballIndex <= 15) {
                        const x = startX + row * (BALL_RADIUS * 2 - 1);
                        const y = startY + (col - row/2) * (BALL_RADIUS * 2 - 1);
                        
                        // Colocar a bola 8 no meio
                        let number = ballIndex;
                        if (row === 2 && col === 1) {
                            number = 8;
                        } else if (ballIndex === 8) {
                            number = row === 4 ? (col === 0 ? 15 : 14) : ballIndex;
                        }
                        
                        balls.push(new Ball(x, y, number, colors[number]));
                        ballIndex++;
                    }
                }
            }
        }
        
        function adjustCanvasSize() {
            const maxWidth = Math.min(window.innerWidth - 40, 800);
            const maxHeight = Math.min(window.innerHeight * 0.6, 400);
            
            // Manter propor√ß√£o 2:1
            let width = maxWidth;
            let height = width / 2;
            
            if (height > maxHeight) {
                height = maxHeight;
                width = height * 2;
            }
            
            canvas.width = width;
            canvas.height = height;
            
            // Ajustar tamanho das bolas baseado no tamanho do canvas
            const scale = width / 800;
            BALL_RADIUS = Math.max(8, 12 * scale);
        }
        
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Desenhar ca√ßapas
            drawPockets();
            
            // Desenhar bolas
            balls.forEach(ball => ball.draw());
            
            // Desenhar linha de mira
            if (aimLine && !gameEnded) {
                ctx.strokeStyle = 'rgba(255,255,255,0.8)';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(cueBall.x, cueBall.y);
                ctx.lineTo(aimLine.x, aimLine.y);
                ctx.stroke();
                ctx.setLineDash([]);
            }
        }
        
        function drawPockets() {
            const pocketSize = Math.max(12, canvas.width * 0.025);
            const borderOffset = Math.max(15, canvas.width * 0.03);
            
            const pockets = [
                {x: borderOffset, y: borderOffset}, 
                {x: canvas.width/2, y: borderOffset * 0.8}, 
                {x: canvas.width - borderOffset, y: borderOffset},
                {x: borderOffset, y: canvas.height - borderOffset}, 
                {x: canvas.width/2, y: canvas.height - borderOffset * 0.8}, 
                {x: canvas.width - borderOffset, y: canvas.height - borderOffset}
            ];
            
            pockets.forEach(pocket => {
                ctx.beginPath();
                ctx.arc(pocket.x, pocket.y, pocketSize, 0, Math.PI * 2);
                ctx.fillStyle = '#000';
                ctx.fill();
                ctx.strokeStyle = '#8B4513';
                ctx.lineWidth = Math.max(1, canvas.width * 0.004);
                ctx.stroke();
            });
        }
        
        function update() {
            balls.forEach(ball => ball.update());
            handleCollisions();
            
            // Verificar se todas as bolas pararam
            const allStopped = balls.every(ball => ball.vx === 0 && ball.vy === 0);
            if (allStopped && !isDragging) {
                // Permitir pr√≥xima jogada
            }
        }
        
        function handleCollisions() {
            for (let i = 0; i < balls.length; i++) {
                for (let j = i + 1; j < balls.length; j++) {
                    const ball1 = balls[i];
                    const ball2 = balls[j];
                    
                    if (ball1.pocketed || ball2.pocketed) continue;
                    
                    const dx = ball2.x - ball1.x;
                    const dy = ball2.y - ball1.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < ball1.radius + ball2.radius) {
                        // Colis√£o detectada
                        const angle = Math.atan2(dy, dx);
                        const sin = Math.sin(angle);
                        const cos = Math.cos(angle);
                        
                        // Separar bolas
                        const overlap = ball1.radius + ball2.radius - distance;
                        ball1.x -= overlap * cos * 0.5;
                        ball1.y -= overlap * sin * 0.5;
                        ball2.x += overlap * cos * 0.5;
                        ball2.y += overlap * sin * 0.5;
                        
                        // Trocar velocidades
                        const vx1 = ball1.vx * cos + ball1.vy * sin;
                        const vy1 = ball1.vy * cos - ball1.vx * sin;
                        const vx2 = ball2.vx * cos + ball2.vy * sin;
                        const vy2 = ball2.vy * cos - ball2.vx * sin;
                        
                        ball1.vx = vx2 * cos - vy1 * sin;
                        ball1.vy = vy1 * cos + vx2 * sin;
                        ball2.vx = vx1 * cos - vy2 * sin;
                        ball2.vy = vy2 * cos + vx1 * sin;
                    }
                }
            }
        }
        
        function switchPlayer() {
            currentPlayer = currentPlayer === 1 ? 2 : 1;
            updateUI();
        }
        
        function checkPlayerBalls() {
            const player1Balls = balls.filter(b => b.isSolid && !b.pocketed);
            const player2Balls = balls.filter(b => b.isStripe && !b.pocketed);
            
            if (player1Balls.length === 0 || player2Balls.length === 0) {
                // Um jogador enca√ßapou todas as suas bolas
                updateUI();
            }
        }
        
        function endGame() {
            gameEnded = true;
            const winner = currentPlayer === 1 ? 2 : 1; // Quem enca√ßapou a bola 8 sem enca√ßapar todas as suas perde
            document.getElementById('status').textContent = `Jogador ${winner} venceu!`;
        }
        
        function updateUI() {
            const player1Element = document.getElementById('player1');
            const player2Element = document.getElementById('player2');
            const statusElement = document.getElementById('status');
            
            player1Element.classList.toggle('active', currentPlayer === 1);
            player2Element.classList.toggle('active', currentPlayer === 2);
            
            if (!gameEnded) {
                statusElement.textContent = `Vez do Jogador ${currentPlayer}`;
            }
            
            // Atualizar contagem de bolas
            const player1Balls = balls.filter(b => b.isSolid && !b.pocketed).length;
            const player2Balls = balls.filter(b => b.isStripe && !b.pocketed).length;
            
            document.getElementById('p1Balls').textContent = `Lisas (${player1Balls} restantes)`;
            document.getElementById('p2Balls').textContent = `Listradas (${player2Balls} restantes)`;
        }
        
        function startPowerMeter() {
            if (powerInterval) return;
            
            powerInterval = setInterval(() => {
                power += powerDirection * 2;
                if (power >= 100) {
                    power = 100;
                    powerDirection = -1;
                } else if (power <= 0) {
                    power = 0;
                    powerDirection = 1;
                }
                powerBar.style.width = power + '%';
            }, 50);
        }
        
        function stopPowerMeter() {
            if (powerInterval) {
                clearInterval(powerInterval);
                powerInterval = null;
            }
        }
        
        // Event listeners
        function getEventPos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            const clientY = e.clientY || (e.touches && e.touches[0].clientY);
            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }
        
        function startAiming(e) {
            if (gameEnded) return;
            e.preventDefault();
            
            const pos = getEventPos(e);
            const dx = pos.x - cueBall.x;
            const dy = pos.y - cueBall.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            if (distance < Math.max(50, canvas.width * 0.08)) {
                isDragging = true;
                startPowerMeter();
            }
        }
        
        function updateAiming(e) {
            if (!isDragging || gameEnded) return;
            e.preventDefault();
            
            const pos = getEventPos(e);
            aimLine = { x: pos.x, y: pos.y };
        }
        
        function shoot(e) {
            if (!isDragging || gameEnded) return;
            e.preventDefault();
            
            stopPowerMeter();
            
            if (aimLine) {
                const dx = aimLine.x - cueBall.x;
                const dy = aimLine.y - cueBall.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance > 0) {
                    const force = (power / 100) * MAX_POWER;
                    cueBall.vx = (dx / distance) * force;
                    cueBall.vy = (dy / distance) * force;
                }
            }
            
            isDragging = false;
            aimLine = null;
            power = 0;
            powerBar.style.width = '0%';
        }
        
        // Mouse events
        canvas.addEventListener('mousedown', startAiming);
        canvas.addEventListener('mousemove', updateAiming);
        canvas.addEventListener('mouseup', shoot);
        canvas.addEventListener('mouseleave', shoot);
        
        // Touch events
        canvas.addEventListener('touchstart', startAiming);
        canvas.addEventListener('touchmove', updateAiming);
        canvas.addEventListener('touchend', shoot);
        canvas.addEventListener('touchcancel', shoot);
        
        // Prevent scrolling on touch
        canvas.addEventListener('touchstart', e => e.preventDefault());
        canvas.addEventListener('touchmove', e => e.preventDefault());
        
        // Resize handler
        window.addEventListener('resize', () => {
            if (!isDragging) {
                adjustCanvasSize();
                // Reposicionar bolas proporcionalmente
                const scaleX = canvas.width / 800;
                const scaleY = canvas.height / 400;
                
                balls.forEach(ball => {
                    if (ball.isCue) {
                        ball.x = canvas.width * 0.25;
                        ball.y = canvas.height / 2;
                    } else {
                        ball.x = Math.min(ball.x * scaleX, canvas.width - BALL_RADIUS);
                        ball.y = Math.min(ball.y * scaleY, canvas.height - BALL_RADIUS);
                    }
                });
            }
        });
        
        function resetGame() {
            stopPowerMeter();
            initGame();
            power = 0;
            powerBar.style.width = '0%';
        }
        
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // Inicializar jogo
        initGame();
        gameLoop();
    </script>
</body>
</html>
