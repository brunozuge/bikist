<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat da Bibi üíï</title>
  <style>
    :root{
      --bg1:#0b1220; --bg2:#151f35; --accent:#ff6b9d; --accent-2:#a78bfa; --my:#1f2a48; --you:#fbe7f1; --text:#e8ecff; --muted:#94a3b8;
      --glass: rgba(255,255,255,.08); --glass-2: rgba(255,255,255,.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text); background: radial-gradient(1200px 600px at 20% -10%, #233053 10%, transparent 60%), linear-gradient(135deg, var(--bg1), var(--bg2));
      overflow:hidden; position:relative;
    }

    /* Aurora suave ao fundo */
    .aurora{position:absolute; inset:-20% -10% -10% -10%; pointer-events:none; filter: blur(30px); opacity:.7;}
    .a1,.a2,.a3{position:absolute; width:70vw; height:70vh; border-radius:50%; mix-blend-mode:screen;}
    .a1{background: radial-gradient(circle at 30% 30%, #7dd3fc, transparent 60%); animation: float1 18s ease-in-out infinite;}
    .a2{background: radial-gradient(circle at 70% 60%, #f0abfc, transparent 60%); animation: float2 22s ease-in-out infinite;}
    .a3{background: radial-gradient(circle at 40% 70%, #fecaca, transparent 60%); animation: float3 26s ease-in-out infinite;}
    @keyframes float1{0%,100%{transform:translate(0,0)}50%{transform:translate(6vw, -3vh)}}
    @keyframes float2{0%,100%{transform:translate(0,0)}50%{transform:translate(-5vw, 4vh)}}
    @keyframes float3{0%,100%{transform:translate(0,0)}50%{transform:translate(2vw, 5vh)}}

    /* Part√≠culas sutis (estrelas/cora√ß√µezinhos) */
    .particles{position:absolute; inset:0; pointer-events:none; overflow:hidden}
    .p{position:absolute; font-size:12px; opacity:.5; animation: rise linear infinite;}
    @keyframes rise{from{transform:translateY(120vh) scale(.9); opacity:.2} to{transform:translateY(-20vh) scale(1.2); opacity:.6}}

    /* App shell - Responsivo */
    .app{
      position: relative; z-index:1; max-width:900px; height:100vh; margin:0 auto; 
      display:grid; grid-template-rows:auto auto 1fr auto auto;
      width: 100%;
    }

    /* Header responsivo */
    .topbar{
      display:flex; align-items:center; gap:8px; padding:12px 16px; 
      backdrop-filter: blur(8px); background: linear-gradient(to right, var(--glass), transparent);
      border-bottom:1px solid rgba(255,255,255,.08);
      min-height: 60px;
    }
    .avatar{
      width:36px; height:36px; border-radius:50%; 
      background:linear-gradient(135deg,#ffd1e6,#b7a7ff); 
      display:grid; place-items:center; color:#5b2b45; font-weight:700;
      font-size: 0.9rem;
      flex-shrink: 0;
    }
    .title{display:flex; flex-direction:column; line-height:1.1; flex: 1; min-width: 0;}
    .title b{font-size:1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
    .title span{font-size:.75rem; color:var(--muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
    
    .actions{
      margin-left:auto; display:flex; gap:4px; flex-shrink: 0;
      flex-wrap: wrap;
    }
    .btn{
      appearance:none; border:1px solid rgba(255,255,255,.12); 
      background:var(--glass); color:var(--text); padding:6px 10px; 
      border-radius:999px; cursor:pointer; font-weight:600;
      font-size: 0.8rem; white-space: nowrap;
      transition: all 0.2s ease;
    }
    .btn:hover{background:var(--glass-2)}

    /* Day tag responsivo */
    .day{
      align-self:center; margin:8px 0; padding:6px 12px; border-radius:999px; 
      background:rgba(255,255,255,.08); font-size:.7rem; color:#c7d2fe;
      max-width: calc(100% - 32px); text-align: center;
    }

    /* √Årea do chat responsiva */
    .chat{
      padding:12px 16px; overflow:auto; display:flex; flex-direction:column; gap:6px; 
      scroll-behavior:smooth; flex: 1;
    }

    .row{display:flex; gap:6px; align-items:flex-end; max-width:100%; margin-bottom: 4px;}
    .row.you{justify-content:flex-start}
    .row.me{justify-content:flex-end}

    .bubble{
      max-width:75%; padding:10px 12px; border-radius:16px; line-height:1.4; 
      font-size:.95rem; position:relative; box-shadow:0 4px 18px rgba(0,0,0,.22);
      word-wrap: break-word; overflow-wrap: break-word; hyphens: auto;
    }
    .you .bubble{background:var(--you); color:#411936; border-bottom-left-radius:6px}
    .me .bubble{background:var(--my); color:#dfe7ff; border-bottom-right-radius:6px}
    .stamp{
      font-size:.65rem; color:var(--muted); margin-top:2px; 
      white-space: nowrap; flex-shrink: 0;
    }

    /* digitando... */
    .typing{
      display:flex; gap:6px; align-items:center; background:var(--you); 
      color:#411936; border-radius:16px; padding:8px 12px; width:90px;
    }
    .dot{width:5px; height:5px; border-radius:50%; background:#ff6b9d; opacity:.8; animation:blink 1.2s infinite}
    .dot:nth-child(2){animation-delay:.2s}
    .dot:nth-child(3){animation-delay:.4s}
    @keyframes blink{0%,80%,100%{transform:translateY(0); opacity:.3}40%{transform:translateY(-3px); opacity:1}}

    /* Quick actions responsivas */
    .quick{
      display:flex; gap:6px; padding:8px 16px 12px; flex-wrap:wrap;
      justify-content: center; max-height: 80px; overflow-y: auto;
    }
    .chip{
      border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.06); 
      color:#fff; padding:6px 10px; border-radius:999px; cursor:pointer; 
      font-size:.8rem; white-space: nowrap; transition: all 0.2s ease;
      flex-shrink: 0;
    }
    .chip:hover{background:rgba(255,255,255,.1)}

    /* composer responsivo */
    .composer{
      display:flex; gap:8px; padding:12px 16px; 
      border-top:1px solid rgba(255,255,255,.08); 
      background:linear-gradient(to right, transparent, var(--glass));
      align-items: stretch;
    }
    .input{
      flex:1; display:flex; align-items:center; gap:8px; 
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); 
      border-radius:14px; padding:8px 12px; min-height: 44px;
    }
    .input input{
      flex:1; background:transparent; border:none; outline:none; 
      color:var(--text); font-size:.95rem; min-width: 0;
    }
    #count{
      font-size:.7rem; color:var(--muted); white-space: nowrap; 
      margin-left: 4px; flex-shrink: 0;
    }
    .send{
      background:var(--accent); border:none; color:white; padding:10px 16px; 
      border-radius:12px; font-weight:700; cursor:pointer; font-size: 0.9rem;
      transition: all 0.2s ease; min-height: 44px; flex-shrink: 0;
    }
    .send:hover{filter:brightness(1.05)}

    /* Modal responsivo */
    .modal{
      position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; 
      align-items:center; justify-content:center; z-index:4; padding: 16px;
    }
    .card{
      width:min(520px, 100%); background:rgba(255,255,255,.08); 
      border:1px solid rgba(255,255,255,.15); border-radius:18px; padding:20px; 
      backdrop-filter: blur(10px); box-shadow:0 30px 60px rgba(0,0,0,.45);
      max-height: 90vh; overflow-y: auto;
    }
    .card h3{margin:0 0 12px; font-size: 1.1rem; line-height: 1.3;}
    .card p{color:#e8ecff; margin:0 0 16px; line-height: 1.5;}
    .card .close{margin-top:12px; width: 100%;}

    /* Tema claro alternativo */
    .light{--bg1:#fff5fb; --bg2:#f3f0ff; --text:#1f2937; --muted:#6b7280; --my:#f1f5ff; --you:#ffeaf3}

    /* Media queries para diferentes tamanhos de tela */
    
    /* Tablets em landscape e desktops pequenos */
    @media (max-width: 1024px) and (min-width: 769px) {
      .app { max-width: 100%; margin: 0; }
      .topbar { padding: 14px 20px; }
      .chat { padding: 16px 20px; }
      .composer { padding: 14px 20px; }
      .quick { padding: 10px 20px 14px; }
    }

    /* Tablets em portrait */
    @media (max-width: 768px) and (min-width: 481px) {
      .app { max-width: 100%; margin: 0; }
      .topbar { 
        padding: 12px 16px; 
        flex-wrap: wrap; 
        gap: 8px;
      }
      .actions { 
        flex-wrap: wrap; 
        gap: 6px;
        width: 100%;
        justify-content: flex-end;
        margin-top: 8px;
        margin-left: 0;
      }
      .btn { 
        padding: 6px 8px; 
        font-size: 0.75rem; 
      }
      .bubble { max-width: 80%; }
      .title b { font-size: 0.95rem; }
      .title span { font-size: 0.7rem; }
      .avatar { width: 32px; height: 32px; font-size: 0.8rem; }
    }

    /* Smartphones */
    @media (max-width: 480px) {
      .app { 
        max-width: 100%; 
        margin: 0;
        height: 100vh;
      }
      
      .topbar { 
        padding: 10px 12px; 
        flex-wrap: wrap;
        min-height: auto;
      }
      
      .avatar { 
        width: 28px; 
        height: 28px; 
        font-size: 0.7rem; 
      }
      
      .title { 
        flex: 1; 
        min-width: 120px; 
      }
      .title b { 
        font-size: 0.85rem; 
      }
      .title span { 
        font-size: 0.65rem; 
      }
      
      .actions { 
        width: 100%; 
        margin-left: 0; 
        margin-top: 8px;
        justify-content: space-between;
      }
      .btn { 
        padding: 4px 8px; 
        font-size: 0.7rem; 
        flex: 1;
        margin: 0 2px;
      }
      
      .chat { 
        padding: 8px 12px; 
        gap: 4px; 
      }
      
      .bubble { 
        max-width: 85%; 
        padding: 8px 10px; 
        font-size: 0.9rem; 
        line-height: 1.35;
      }
      
      .stamp { 
        font-size: 0.6rem; 
        margin-top: 1px; 
      }
      
      .quick { 
        padding: 6px 12px 8px; 
        gap: 4px;
        max-height: 60px;
      }
      .chip { 
        padding: 4px 8px; 
        font-size: 0.7rem; 
      }
      
      .composer { 
        padding: 8px 12px; 
        gap: 6px; 
      }
      .input { 
        padding: 6px 10px; 
        min-height: 40px;
      }
      .input input { 
        font-size: 0.9rem; 
      }
      #count { 
        font-size: 0.65rem; 
      }
      .send { 
        padding: 8px 12px; 
        font-size: 0.8rem; 
        min-height: 40px;
      }
      
      .day { 
        font-size: 0.65rem; 
        padding: 4px 8px; 
        margin: 6px 0; 
      }
      
      .typing { 
        width: 70px; 
        padding: 6px 8px; 
      }
      .dot { 
        width: 4px; 
        height: 4px; 
      }
      
      .modal { 
        padding: 12px; 
      }
      .card { 
        padding: 16px; 
        border-radius: 12px;
      }
      .card h3 { 
        font-size: 1rem; 
      }
      .card p { 
        font-size: 0.9rem; 
      }
    }

    /* Smartphones muito pequenos */
    @media (max-width: 320px) {
      .topbar { padding: 8px 10px; }
      .chat { padding: 6px 10px; }
      .composer { padding: 6px 10px; }
      .quick { padding: 4px 10px 6px; }
      
      .bubble { 
        max-width: 88%; 
        padding: 6px 8px; 
        font-size: 0.85rem; 
      }
      
      .btn { 
        padding: 3px 6px; 
        font-size: 0.65rem; 
      }
      
      .chip { 
        padding: 3px 6px; 
        font-size: 0.65rem; 
      }
      
      .input { 
        padding: 4px 8px; 
        min-height: 36px;
      }
      .send { 
        padding: 6px 10px; 
        min-height: 36px;
        font-size: 0.75rem;
      }
    }

    /* Landscape em smartphones */
    @media (max-height: 500px) and (orientation: landscape) {
      .app { 
        grid-template-rows: auto auto 1fr auto auto; 
      }
      .topbar { 
        padding: 6px 12px; 
        min-height: 44px;
      }
      .chat { 
        padding: 6px 12px; 
      }
      .composer { 
        padding: 6px 12px; 
      }
      .quick { 
        padding: 4px 12px 6px; 
        max-height: 50px;
      }
      .day { 
        margin: 4px 0; 
      }
      .bubble { 
        padding: 6px 8px; 
        font-size: 0.85rem; 
      }
    }

    /* Ajustes para part√≠culas em telas pequenas */
    @media (max-width: 480px) {
      .particles { 
        opacity: 0.6; 
      }
      .p { 
        font-size: 8px; 
      }
    }

    /* Scroll customizado para dispositivos m√≥veis */
    .chat::-webkit-scrollbar {
      width: 3px;
    }
    .chat::-webkit-scrollbar-track {
      background: transparent;
    }
    .chat::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
    }

    /* Melhor touch target para dispositivos m√≥veis */
    @media (hover: none) and (pointer: coarse) {
      .btn, .chip, .send {
        min-height: 44px;
        min-width: 44px;
      }
      .input {
        min-height: 44px;
      }
    }
  </style>
</head>
<body>
  <!-- fundos -->
  <div class="aurora" aria-hidden="true">
    <div class="a1"></div><div class="a2"></div><div class="a3"></div>
  </div>
  <div class="particles" id="particles" aria-hidden="true"></div>

  <div class="app" id="app">
    <header class="topbar">
      <div class="avatar">BZ</div>
      <div class="title">
        <b>Bibi üíñ</b>
        <span id="status">online ‚Ä¢ digitando‚Ä¶ √†s vezes üòÑ</span>
      </div>
      <div class="actions">
        <button class="btn" id="toggleTheme">Tema</button>
        <button class="btn" id="surprise">‚ú®</button>
        <button class="btn" id="soundBtn">Som</button>
      </div>
    </header>

    <div class="day" id="dayTag"></div>

    <main class="chat" id="chat" aria-live="polite"></main>

    <div class="quick" id="quick">
      <button class="chip" data-msg="Oi, meu amor! Como voc√™ t√°?">Oi, meu amor! üíó</button>
      <button class="chip" data-msg="Pensei em voc√™ o dia todo‚Ä¶">Pensei em voc√™‚Ä¶ ‚ú®</button>
      <button class="chip" data-msg="Vamos planejar nosso final de semana?">Final de semana? üóìÔ∏è</button>
      <button class="chip" data-msg="Quero te contar uma coisa‚Ä¶">Tenho um segredo ü§´</button>
      <button class="chip" data-msg="Aceita um abra√ßo bem apertado?">Um abra√ßo? ü§ç</button>
    </div>

    <footer class="composer">
      <div class="input"><input id="text" placeholder="Escreva uma mensagem‚Ä¶" maxlength="240" /><span id="count" aria-hidden="true">0/240</span></div>
      <button class="send" id="send">Enviar</button>
    </footer>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="card">
      <h3>Minha mensagem para voc√™ üíå</h3>
      <p>Entre todas as palavras, escolho as suas. Entre todos os lugares, escolho o seu abra√ßo. Entre todos os futuros, escolho o nosso. ‚ôæÔ∏è</p>
      <button class="btn close" id="closeModal">Fechar</button>
    </div>
  </div>

  <audio id="snd" preload="auto">
    <source src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQAA..." type="audio/mp3" />
  </audio>

  <script>
    // Util: hora
    const ts = () => new Date().toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'});

    // Estado
    const chatEl = document.getElementById('chat');
    const inputEl = document.getElementById('text');
    const countEl = document.getElementById('count');
    const snd = document.getElementById('snd');
    let soundOn = false;

    // Mensagens autom√°ticas da Bibi
    const replies = [
      "Eu tava pensando em voc√™ agora mesmo üíï",
      "Seu nome tem um cantinho reservado no meu cora√ß√£o ‚ú®",
      "Que tal um abra√ßo bem longo hoje? ü§ç",
      "S√≥ de lembrar do seu sorriso, meu dia fica melhor üòä",
      "Eu escolho voc√™. Sempre. ‚ôæÔ∏è",
      "Vamos planejar algo gostoso pro final de semana? üç∞"
    ];

    // Tipando efeito
    function typeText(el, text, speed = 18){
      return new Promise(resolve=>{
        let i=0; const t = setInterval(()=>{ el.textContent += text.charAt(i++); if(i>text.length){clearInterval(t); resolve();}}, speed);
      });
    }

    // Bolha
    function bubble({from='me', text='', time=ts()}){
      const row = document.createElement('div'); row.className = `row ${from}`;
      const b = document.createElement('div'); b.className = 'bubble';
      const s = document.createElement('div'); s.className = 'stamp'; s.textContent = time;
      row.appendChild(b); row.appendChild(s);
      chatEl.appendChild(row);
      chatEl.scrollTop = chatEl.scrollHeight;
      return {row, b};
    }

    // Digitando indicador
    function typing(){
      const row = document.createElement('div'); row.className = 'row you';
      const box = document.createElement('div'); box.className = 'typing';
      box.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
      row.appendChild(box); chatEl.appendChild(row); chatEl.scrollTop = chatEl.scrollHeight;
      return {row};
    }

    // Responder fluxo
    async function respond(userText){
      // minha msg
      const {b: myB} = bubble({from:'me'});
      await typeText(myB, userText);
      if(soundOn) try{ snd.currentTime=0; snd.play().catch(()=>{});}catch{}

      // indicador
      const t = typing();
      await new Promise(r=>setTimeout(r, 700 + Math.random()*900));

      // resposta
      t.row.remove();
      const {b: youB} = bubble({from:'you'});
      const answer = smartReply(userText);
      await typeText(youB, answer);
      if(soundOn) try{ snd.currentTime=0; snd.play().catch(()=>{});}catch{}
      persist();
    }

    // Resposta baseada no texto
    function smartReply(text){
      const t = text.toLowerCase();
      if(t.includes('saudade')||t.includes('sdds')) return 'Saudade tem nome e endere√ßo: voc√™ no meu abra√ßo. üíû';
      if(t.includes('final')||t.includes('fim de semana')||t.includes('s√°bado')||t.includes('domingo')) return 'Topo um caf√© com p√¥r do sol ou filminho com coberta? ‚òïüåá';
      if(t.includes('segredo')) return 'Conta baixinho no meu ouvido‚Ä¶ prometo guardar no cora√ß√£o ü§´üíó';
      if(t.includes('amo')||t.includes('te amo')) return 'Eu te amo mais. Discuss√£o encerrada. üòåüíò';
      if(t.includes('abra√ßo')) return 'Abra√ßo aprovado e solicitado. Quando? Agora. ü´Ç';
      if(t.includes('beijo')) return 'Cientificamente comprovado: beijos seus curam qualquer coisa. üíã';
      return replies[Math.floor(Math.random()*replies.length)];
    }

    // Quick chips
    document.getElementById('quick').addEventListener('click', (e)=>{
      if(e.target.classList.contains('chip')){
        send(e.target.getAttribute('data-msg'));
      }
    });

    // Envio
    document.getElementById('send').addEventListener('click', ()=> send());
    inputEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); send(); }});
    inputEl.addEventListener('input', ()=>{ countEl.textContent = `${inputEl.value.length}/240`; });

    function send(prefill){
      const txt = (prefill ?? inputEl.value).trim();
      if(!txt) return;
      inputEl.value=''; countEl.textContent='0/240';
      respond(txt);
    }

    // Dia tag
    const dayTag = document.getElementById('dayTag');
    dayTag.textContent = new Date().toLocaleDateString('pt-BR', {weekday:'long', day:'2-digit', month:'long'});

    // Modal
    const modal = document.getElementById('modal');
    document.getElementById('surprise').onclick = ()=>{ modal.style.display='flex'; };
    document.getElementById('closeModal').onclick = ()=>{ modal.style.display='none'; };
    modal.addEventListener('click', (e)=>{ if(e.target===modal) modal.style.display='none'; });

    // Tema
    const toggleThemeBtn = document.getElementById('toggleTheme');
    let light=false; toggleThemeBtn.onclick = ()=>{ light = !light; document.documentElement.classList.toggle('light', light); };

    // Som
    document.getElementById('soundBtn').onclick = (e)=>{ soundOn = !soundOn; e.target.textContent = soundOn? 'Som ‚úì':'Som'; };

    // Part√≠culas
    const particles = document.getElementById('particles');
    function spawnParticles(){
      // Menos part√≠culas em telas pequenas
      const particleCount = window.innerWidth < 480 ? 8 : 18;
      for(let i=0;i<particleCount;i++){
        const n = document.createElement('div');
        n.className='p'; n.textContent = Math.random()>0.5 ? '‚ú¶' : '‚ù§';
        n.style.left = (Math.random()*100)+'vw';
        n.style.animationDuration = (8+Math.random()*10)+'s';
        n.style.fontSize = (10+Math.random()*(window.innerWidth < 480 ? 12 : 18))+'px';
        n.style.opacity = 0.25 + Math.random()*0.5;
        particles.appendChild(n);
        setTimeout(()=> n.remove(), 18000);
      }
    }
    spawnParticles(); setInterval(spawnParticles, window.innerWidth < 480 ? 6000 : 4000);

    // Persist√™ncia simples
    function persist(){ 
      try {
        localStorage.setItem('bibi_chat', chatEl.innerHTML);
      } catch(e) {
        console.log('Storage n√£o dispon√≠vel');
      }
    }
    function restore(){ 
      try {
        const d = localStorage.getItem('bibi_chat'); 
        if(d){ 
          chatEl.innerHTML = d; 
          setTimeout(()=> chatEl.scrollTop = chatEl.scrollHeight, 0);
        } else { 
          intro(); 
        }
      } catch(e) {
        intro();
      }
    }

    // Mensagem inicial
    async function intro(){
      const t = typing();
      await new Promise(r=>setTimeout(r, 900));
      t.row.remove();
      const {b} = bubble({from:'you'});
      await typeText(b, 'Oi, amor. Que bom te ver aqui. Pronto pra nossa conversa? üí¨üíñ');
      persist();
    }

    // Ajustar altura do viewport em dispositivos m√≥veis
    function setViewportHeight() {
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    
    setViewportHeight();
    window.addEventListener('resize', setViewportHeight);
    window.addEventListener('orientationchange', () => {
      setTimeout(setViewportHeight, 100);
    });

    restore();
  </script>
</body>
</html>
